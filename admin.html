<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Panel de Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background: #0f172a;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      padding: 20px;
    }
    h1 { text-align: center; margin-bottom: 20px; }
    .box {
      background: #1e293b;
      border-radius: 16px;
      padding: 20px;
      max-width: 700px;
      margin: 0 auto 40px auto;
    }
    label { display: block; margin-top: 10px; }
    input {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      margin-top: 5px;
      background: #334155;
      color: #fff;
    }
    .btn {
      margin-top: 15px;
      padding: 10px;
      background: #3b82f6;
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
    }
    .btn:hover { background: #2563eb; }
    .tasks { margin-top: 15px; }
    .task-item {
      background: #334155;
      padding: 10px;
      border-radius: 8px;
      margin-top: 5px;
    }
    a.upload {
      display: inline-block;
      background: #10b981;
      padding: 8px 12px;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      margin-bottom: 10px;
    }

    /* Publicaciones existentes */
    .list {
      max-width: 700px;
      margin: auto;
    }
    .post {
      background: #1e293b;
      padding: 15px;
      border-radius: 10px;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .post img {
      width: 80px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
    }
    .post-info { flex: 1; }
    .post button {
      background: #ef4444;
      border: none;
      color: white;
      border-radius: 8px;
      padding: 8px 10px;
      cursor: pointer;
      transition: 0.2s;
    }
    .post button:hover { background: #dc2626; }
    .edit-btn {
      background: #10b981 !important;
    }
  </style>
</head>
<body>
  <h1>Panel de Administración</h1>

  <!-- FORMULARIO -->
  <div class="box" id="formBox">
    <a href="https://postimages.org/es/" target="_blank" class="upload">Subir Imagen</a>
    <label>Link de Imagen</label>
    <input type="text" id="image">

    <label>Título</label>
    <input type="text" id="title">

    <label>Link de Descarga (Mediafire u otro)</label>
    <input type="text" id="download">

    <div class="tasks" id="tasksContainer"></div>
    <button class="btn" id="addTask">Agregar Botón (Ej: Unirse a TikTok)</button>

    <button class="btn" id="save">Guardar Publicación</button>
  </div>

  <!-- LISTA DE PUBLICACIONES -->
  <div class="list" id="postsList">
    <h2 style="text-align:center;">Publicaciones Existentes</h2>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAQAfdb3O0GzkQTrpmqUmFq38szrf3PJhw",
      authDomain: "domini-6fae2.firebaseapp.com",
      projectId: "domini-6fae2",
      storageBucket: "domini-6fae2.firebasestorage.app",
      messagingSenderId: "990218506087",
      appId: "1:990218506087:web:a577eed88dea8882c0e9c2",
      databaseURL: "https://domini-6fae2-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const tasksContainer = document.getElementById('tasksContainer');
    const addTaskBtn = document.getElementById('addTask');
    const saveBtn = document.getElementById('save');
    const postsList = document.getElementById('postsList');

    let tasks = [];
    let editingId = null; // si está editando una publicación

    addTaskBtn.onclick = () => {
      const name = prompt('Nombre del botón (Ej: Unirse a YouTube)');
      const link = prompt('Link del botón');
      if (name && link) {
        tasks.push({ name, link });
        renderTasks();
      }
    };

    function renderTasks() {
      tasksContainer.innerHTML = '';
      tasks.forEach((t, i) => {
        const div = document.createElement('div');
        div.className = 'task-item';
        div.innerHTML = `${t.name} - <a href="${t.link}" target="_blank">${t.link}</a>`;
        tasksContainer.appendChild(div);
      });
    }

    saveBtn.onclick = () => {
      const image = document.getElementById('image').value;
      const title = document.getElementById('title').value;
      const download = document.getElementById('download').value;

      if (!image || !title || !download) {
        alert('Completa todos los campos');
        return;
      }

      if (editingId) {
        // Modo editar
        const postRef = ref(db, 'posts/' + editingId);
        update(postRef, { image, title, download, tasks });
        alert('Publicación actualizada correctamente');
        editingId = null;
        saveBtn.textContent = 'Guardar Publicación';
      } else {
        // Modo crear nuevo
        const postRef = push(ref(db, 'posts'));
        set(postRef, { image, title, download, tasks });
        alert('Publicación guardada correctamente');
      }

      resetForm();
    };

    function resetForm() {
      document.getElementById('image').value = '';
      document.getElementById('title').value = '';
      document.getElementById('download').value = '';
      tasks = [];
      renderTasks();
    }

    // Cargar publicaciones
    onValue(ref(db, 'posts'), (snapshot) => {
      postsList.innerHTML = '<h2 style="text-align:center;">Publicaciones Existentes</h2>';
      snapshot.forEach(child => {
        const data = child.val();
        const id = child.key;
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <img src="${data.image}" alt="">
          <div class="post-info">
            <h3>${data.title}</h3>
            <p>${data.tasks ? data.tasks.length : 0} botones</p>
          </div>
          <button class="edit-btn">Editar</button>
          <button class="delete-btn">Eliminar</button>
        `;

        // Eliminar publicación
        div.querySelector('.delete-btn').addEventListener('click', () => {
          if (confirm('¿Seguro que deseas eliminar esta publicación?')) {
            remove(ref(db, 'posts/' + id));
          }
        });

        // Editar publicación
        div.querySelector('.edit-btn').addEventListener('click', () => {
          document.getElementById('image').value = data.image;
          document.getElementById('title').value = data.title;
          document.getElementById('download').value = data.download;
          tasks = data.tasks || [];
          renderTasks();
          editingId = id;
          saveBtn.textContent = 'Guardar Cambios';
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        postsList.appendChild(div);
      });
    });
  </script>
</body>
</html>
